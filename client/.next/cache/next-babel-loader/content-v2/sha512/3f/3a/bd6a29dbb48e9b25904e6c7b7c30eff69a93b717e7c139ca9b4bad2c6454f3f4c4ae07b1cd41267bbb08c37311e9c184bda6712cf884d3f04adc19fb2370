{"ast":null,"code":"import _regeneratorRuntime from \"/Users/rjb/Desktop/code/projects/rfp/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/rjb/Desktop/code/projects/rfp/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/Users/rjb/Desktop/code/projects/rfp/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/rjb/Desktop/code/projects/rfp/client/pages/_app.js\",\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport \"semantic-ui-css/semantic.min.css\";\nimport { useRouter } from \"next/router\";\nimport { Footer } from \"../components/nav/Footer\";\nimport { SiteHeader } from \"../components/nav/SiteHeader\";\nimport { AdminHeader } from \"../components/nav/AdminHeader\";\nimport { buildClient } from \"../api/build-client\";\nimport { checkExistenceOfSite } from \"../hooks/use-site-existence\";\nimport NoSite from \"../components/error/site-does-not-exist\";\nimport { useEffect } from \"react\";\nimport * as gtag from \"../components/util/gtag\";\nimport Layout from \"../components/layouts\";\n\nfunction AppComponent(_ref) {\n  _s();\n\n  var _this = this;\n\n  var Component = _ref.Component,\n      pageProps = _ref.pageProps,\n      user = _ref.user,\n      siteExists = _ref.siteExists,\n      authUserIsAdmin = _ref.authUserIsAdmin;\n  var router = useRouter();\n  var isAdmin = router.pathname.includes(\"/admin/[site]\");\n  useEffect(function () {\n    var handleRouteChange = function handleRouteChange(url) {\n      gtag.pageview(url);\n    };\n\n    router.events.on(\"routeChangeComplete\", handleRouteChange);\n    return function () {\n      router.events.off(\"routeChangeComplete\", handleRouteChange);\n    };\n  }, [router.events]);\n\n  var renderHeader = function renderHeader() {\n    return isAdmin ? /*#__PURE__*/_jsxDEV(AdminHeader, {\n      user: user,\n      siteExists: siteExists\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 7\n    }, _this) : /*#__PURE__*/_jsxDEV(SiteHeader, {\n      user: user,\n      siteExists: siteExists,\n      authUserIsAdmin: authUserIsAdmin\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 39,\n      columnNumber: 7\n    }, _this);\n  };\n\n  var renderComponent = function renderComponent() {\n    return /*#__PURE__*/_jsxDEV(Component, _objectSpread({}, pageProps), void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 33\n    }, _this);\n  };\n\n  var layout = function layout() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [renderHeader(), /*#__PURE__*/_jsxDEV(Component, _objectSpread({}, pageProps), void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 53,\n        columnNumber: 7\n      }, _this), /*#__PURE__*/_jsxDEV(Footer, {\n        siteType: isAdmin ? \"admin\" : \"user\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 55,\n        columnNumber: 7\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 5\n    }, _this);\n  }; // mon 8:42 change\n  // return <Layout layout={layout()} children={layout}></Layout>;\n\n\n  return layout(); // return siteExists ? layout() : <NoSite />;\n}\n\n_s(AppComponent, \"vQduR7x+OPXj6PSmJyFnf+hU7bg=\", false, function () {\n  return [useRouter];\n});\n\n_c = AppComponent;\n\nAppComponent.getInitialProps = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(appContext) {\n    var _yield$checkExistence, siteExists, siteInfo, client, _yield$client$get, currentUser, user, pageProps, authUserIsAdmin, domainUrl;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return checkExistenceOfSite({\n              context: appContext.ctx\n            });\n\n          case 2:\n            _yield$checkExistence = _context.sent;\n            siteExists = _yield$checkExistence.siteExists;\n            siteInfo = _yield$checkExistence.siteInfo;\n\n            if (siteExists) {\n              _context.next = 7;\n              break;\n            }\n\n            return _context.abrupt(\"return\", {\n              siteExists: siteExists\n            });\n\n          case 7:\n            client = buildClient(appContext.ctx);\n            _context.next = 10;\n            return client.get(\"/api/users/currentuser\");\n\n          case 10:\n            _yield$client$get = _context.sent;\n            currentUser = _yield$client$get.data;\n            user = currentUser.currentUser;\n            pageProps = {};\n\n            if (!appContext.Component.getInitialProps) {\n              _context.next = 18;\n              break;\n            }\n\n            _context.next = 17;\n            return appContext.Component.getInitialProps(appContext.ctx);\n\n          case 17:\n            pageProps = _context.sent;\n\n          case 18:\n            authUserIsAdmin = user && user.id === siteInfo.ownerId;\n\n            if (appContext.ctx.req) {\n              domainUrl = appContext.ctx.req.headers.host;\n            }\n\n            return _context.abrupt(\"return\", {\n              pageProps: pageProps,\n              user: user,\n              siteExists: siteExists,\n              siteInfo: siteInfo,\n              authUserIsAdmin: authUserIsAdmin,\n              domainUrl: domainUrl\n            });\n\n          case 21:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport default AppComponent;\n\nvar _c;\n\n$RefreshReg$(_c, \"AppComponent\");","map":{"version":3,"sources":["/Users/rjb/Desktop/code/projects/rfp/client/pages/_app.js"],"names":["useRouter","Footer","SiteHeader","AdminHeader","buildClient","checkExistenceOfSite","NoSite","useEffect","gtag","Layout","AppComponent","Component","pageProps","user","siteExists","authUserIsAdmin","router","isAdmin","pathname","includes","handleRouteChange","url","pageview","events","on","off","renderHeader","renderComponent","layout","getInitialProps","appContext","context","ctx","siteInfo","client","get","currentUser","data","id","ownerId","req","domainUrl","headers","host"],"mappings":"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","sourcesContent":["import \"semantic-ui-css/semantic.min.css\";\nimport { useRouter } from \"next/router\";\nimport { Footer } from \"../components/nav/Footer\";\nimport { SiteHeader } from \"../components/nav/SiteHeader\";\nimport { AdminHeader } from \"../components/nav/AdminHeader\";\nimport { buildClient } from \"../api/build-client\";\nimport { checkExistenceOfSite } from \"../hooks/use-site-existence\";\nimport NoSite from \"../components/error/site-does-not-exist\";\nimport { useEffect } from \"react\";\nimport * as gtag from \"../components/util/gtag\";\nimport Layout from \"../components/layouts\";\n\nfunction AppComponent({\n  Component,\n  pageProps,\n  user,\n  siteExists,\n  authUserIsAdmin,\n}) {\n  const router = useRouter();\n  const isAdmin = router.pathname.includes(\"/admin/[site]\");\n\n  useEffect(() => {\n    const handleRouteChange = (url) => {\n      gtag.pageview(url);\n    };\n\n    router.events.on(\"routeChangeComplete\", handleRouteChange);\n\n    return () => {\n      router.events.off(\"routeChangeComplete\", handleRouteChange);\n    };\n  }, [router.events]);\n\n  const renderHeader = () => {\n    return isAdmin ? (\n      <AdminHeader user={user} siteExists={siteExists} />\n    ) : (\n      <SiteHeader\n        user={user}\n        siteExists={siteExists}\n        authUserIsAdmin={authUserIsAdmin}\n      />\n    );\n  };\n\n  const renderComponent = () => <Component {...pageProps} />;\n\n  const layout = () => (\n    <div>\n      {renderHeader()}\n\n      <Component {...pageProps} />\n\n      <Footer siteType={isAdmin ? \"admin\" : \"user\"} />\n    </div>\n  );\n\n  // mon 8:42 change\n  // return <Layout layout={layout()} children={layout}></Layout>;\n  return layout();\n\n  // return siteExists ? layout() : <NoSite />;\n}\n\nAppComponent.getInitialProps = async (appContext) => {\n  const { siteExists, siteInfo } = await checkExistenceOfSite({\n    context: appContext.ctx,\n  });\n\n  if (!siteExists) {\n    return { siteExists };\n  }\n\n  const client = buildClient(appContext.ctx);\n\n  const { data: currentUser } = await client.get(\"/api/users/currentuser\");\n  const user = currentUser.currentUser;\n\n  let pageProps = {};\n\n  if (appContext.Component.getInitialProps) {\n    pageProps = await appContext.Component.getInitialProps(appContext.ctx);\n  }\n\n  const authUserIsAdmin = user && user.id === siteInfo.ownerId;\n\n  let domainUrl;\n\n  if (appContext.ctx.req) {\n    domainUrl = appContext.ctx.req.headers.host;\n  }\n\n  return { pageProps, user, siteExists, siteInfo, authUserIsAdmin, domainUrl };\n};\n\nexport default AppComponent;\n"]},"metadata":{},"sourceType":"module"}