{"ast":null,"code":"import _regeneratorRuntime from \"/Users/rjb/Desktop/code/projects/rfp/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/rjb/Desktop/code/projects/rfp/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useState, useEffect, Fragment } from \"react\";\nimport Link from \"next/link\";\nimport { Header, Segment, Divider } from \"semantic-ui-react\";\nimport Card from \"../../../components/user-site/CartCard\";\nimport Checkout from \"../../../components/user-site/Checkout\";\nimport { getCart } from \"../../../hooks/cart-helpers\";\nimport { useRouter } from \"next/router\";\nimport { buildClient } from \"../../../api/build-client\";\nimport { useAuth } from \"../../../hooks/use-auth\";\nimport Layout from \"../../../components/layouts\";\n\nvar Cart = function Cart(_ref) {\n  var user = _ref.user;\n\n  var _useState = useState([]),\n      items = _useState[0],\n      setItems = _useState[1];\n\n  var _useState2 = useState(false),\n      success = _useState2[0],\n      setSuccess = _useState2[1];\n\n  var _useState3 = useState(false),\n      run = _useState3[0],\n      setRun = _useState3[1]; // to avoid infinite loop\n\n\n  var link = useRouter().query.site;\n  useEffect(function () {\n    window.scrollTo(0, 0);\n    setItems(getCart());\n  }, [run]);\n\n  var showItems = function showItems() {\n    return /*#__PURE__*/_jsx(Segment, {\n      children: items.map(function (product, i) {\n        return /*#__PURE__*/_jsxs(Fragment, {\n          children: [/*#__PURE__*/_jsx(Card, {\n            product: product,\n            showAddToCartButton: false,\n            cartUpdate: true,\n            showRemoveItemButton: true,\n            run: run,\n            setRun: setRun\n          }, i), /*#__PURE__*/_jsx(Divider, {})]\n        });\n      })\n    });\n  };\n\n  var noItemsMessage = function noItemsMessage() {\n    if (success) {\n      return \"\";\n    } else {\n      return /*#__PURE__*/_jsxs(Fragment, {\n        children: [/*#__PURE__*/_jsx(Header, {\n          children: \"Cart Empty\"\n        }), /*#__PURE__*/_jsx(Link, {\n          href: \"/user/\".concat(link, \"/services\"),\n          children: \"Shop for services\"\n        })]\n      });\n    }\n  };\n\n  var renderIfAuth = function renderIfAuth() {\n    return /*#__PURE__*/_jsxs(Layout, {\n      smallLeaderboard: true,\n      leaderboardData: {\n        header: \"There are \".concat(items.length, \" item\").concat(items.length > 0 ? \"s\" : \"\", \" in your order\"),\n        subHeader: \"Shop for services, and submit the details when ready.\",\n        dividerText: \"Items\"\n      },\n      children: [/*#__PURE__*/_jsx(Checkout, {\n        products: items.map(function (i) {\n          return i.item;\n        }),\n        user: user,\n        setRun: setRun,\n        run: run,\n        tellSuccess: function tellSuccess(bool) {\n          setSuccess(bool);\n        }\n      }), items.length > 0 ? showItems(items) : noItemsMessage()]\n    });\n  };\n\n  return useAuth({\n    user: user,\n    currentUrlSite: link,\n    renderIfAuth: renderIfAuth\n  });\n};\n\nCart.getInitialProps = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(context) {\n    var client, _yield$client$get, currentUser, user;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            client = buildClient(context);\n            _context.next = 3;\n            return client.get(\"/api/users/currentuser\");\n\n          case 3:\n            _yield$client$get = _context.sent;\n            currentUser = _yield$client$get.data;\n            user = currentUser.currentUser;\n            return _context.abrupt(\"return\", {\n              user: user\n            });\n\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport default Cart;","map":null,"metadata":{},"sourceType":"module"}