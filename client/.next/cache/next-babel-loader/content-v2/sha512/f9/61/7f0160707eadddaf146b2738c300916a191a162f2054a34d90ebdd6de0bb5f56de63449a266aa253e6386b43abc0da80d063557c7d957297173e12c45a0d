{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Item, Button, Label, Icon, Popup, Card, Header, List } from \"semantic-ui-react\";\nimport { useRequest } from \"../../hooks/use-request\";\nimport Router from \"next/router\";\nimport { UpdatePaymentPerSubscription } from \"../payment/UpdatePaymentPerSubscription\";\nimport { Elements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nconst stripePromise = loadStripe(\"pk_test_51HcBP1AbNtIO9WIz2YyuWzAj9jjcgkBW4m1CFzKTMa3F80USq2ic8Hg5BNBFQdV5CCSw8voWoMXZCGxw2RNLVulQ001jMUK3UP\");\n\nconst CurrentSubscription = ({\n  subscription,\n  site,\n  userOfSite,\n  pay\n}) => {\n  const {\n    doRequest,\n    errors\n  } = useRequest({\n    url: `/api/site/${site}`,\n    method: \"delete\",\n    onSuccess: () => Router.push(`/admin/${userOfSite}/account/sites`)\n  });\n\n  const deleteSiteSubscription = async () => {\n    await doRequest();\n  };\n\n  const showSubscription = () => {\n    const {\n      plan,\n      id,\n      status,\n      trial_end,\n      current_period_end\n    } = subscription;\n    const {\n      last4,\n      exp_year,\n      exp_month,\n      brand\n    } = pay.card;\n    const {\n      amount,\n      interval\n    } = plan;\n    const trialEnd = new Date(trial_end * 1000);\n    const now = new Date();\n\n    const getReadableDate = date => `${date.getMonth() + 1}/${date.getDate()}/${date.getFullYear()}`;\n\n    const trialEndDate = getReadableDate(trialEnd);\n    const nextBill = new Date(current_period_end * 1000);\n    const nextBillDate = getReadableDate(nextBill);\n    return /*#__PURE__*/_jsxs(\"div\", {\n      children: [/*#__PURE__*/_jsxs(Item.Group, {\n        children: [/*#__PURE__*/_jsx(Item, {\n          children: /*#__PURE__*/_jsx(Item.Content, {\n            children: /*#__PURE__*/_jsxs(Item.Header, {\n              as: \"a\",\n              children: [\" \", \"$\", amount / 100, \" per \", interval]\n            })\n          })\n        }), /*#__PURE__*/_jsx(Item, {\n          children: /*#__PURE__*/_jsx(Elements, {\n            stripe: stripePromise,\n            children: /*#__PURE__*/_jsx(UpdatePaymentPerSubscription, {\n              subscription: subscription\n            })\n          })\n        }), /*#__PURE__*/_jsx(Item, {\n          children: /*#__PURE__*/_jsxs(Item.Content, {\n            children: [/*#__PURE__*/_jsxs(Item.Header, {\n              children: [brand.charAt(0).toUpperCase() + brand.slice(1), \" On File\"]\n            }), /*#__PURE__*/_jsxs(Item.Meta, {\n              children: [/*#__PURE__*/_jsx(Icon, {\n                name: \"credit card outline\"\n              }), \" \", last4, \" expires \", exp_month, \"/\", exp_year]\n            }), /*#__PURE__*/_jsx(Item.Extra, {\n              children: /*#__PURE__*/_jsxs(Label, {\n                children: [\"Next Bill \", nextBillDate]\n              })\n            }), /*#__PURE__*/_jsxs(Item.Extra, {\n              children: [/*#__PURE__*/_jsx(Popup, {\n                trigger: /*#__PURE__*/_jsx(Button, {\n                  color: \"red\",\n                  icon: \"delete\",\n                  content: \"Cancel Subscription And Delete Site\"\n                }),\n                content: /*#__PURE__*/_jsxs(Card, {\n                  children: [/*#__PURE__*/_jsxs(Card.Content, {\n                    children: [/*#__PURE__*/_jsx(Card.Header, {\n                      children: /*#__PURE__*/_jsx(Header, {\n                        children: \"Are you sure?\"\n                      })\n                    }), /*#__PURE__*/_jsxs(List, {\n                      bulleted: true,\n                      children: [/*#__PURE__*/_jsx(List.Item, {\n                        children: \"This is an irreversible action.\"\n                      }), /*#__PURE__*/_jsx(List.Item, {\n                        children: \"All data associated with the site will be deleted immediately, and cannot be recovered.\"\n                      }), /*#__PURE__*/_jsx(List.Item, {\n                        children: \"You will not be charged again on your next billing date.\"\n                      })]\n                    })]\n                  }), /*#__PURE__*/_jsx(Button, {\n                    size: \"tiny\",\n                    attached: \"bottom\",\n                    negative: true,\n                    onClick: deleteSiteSubscription,\n                    children: \"Yes - Cancel my subscription\"\n                  })]\n                }),\n                on: \"click\",\n                position: \"top right\"\n              }), trialEnd > now ? /*#__PURE__*/_jsxs(Label, {\n                children: [\"Free trial expires \", trialEndDate]\n              }) : null]\n            })]\n          })\n        })]\n      }), errors ? errors : null]\n    });\n  };\n\n  return subscription ? showSubscription() : /*#__PURE__*/_jsx(\"div\", {\n    children: \"no subscription found\"\n  });\n};\n\nexport { CurrentSubscription };","map":null,"metadata":{},"sourceType":"module"}